<?php

namespace WebsiteApi\DiscussionBundle\Repository;

/**
 * StreamMemberRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class StreamMemberRepository extends \WebsiteApi\CoreBundle\Services\DoctrineAdapter\RepositoryAdapter
{

	public function removeStream($stream){
        $qb = $this->createQueryBuilder('s');
        $qb->delete();
        $qb->where('s.stream = :stream');
        $qb->setParameter('stream', $stream);
        $qb->getQuery()->execute();
	}

	public function findUnreadMessage($user){
        $qb = $this->createQueryBuilder('u');
        $qb->where('u.unread > 0 AND u.user = :user');
        $qb->setParameter('user', $user);
        $result = $qb->getQuery()->getResult();

        return $result;
    }

    public function findOneBy(array $array)
    {
        if (isset($array["user"]) && isset($array["stream"])) {
            if (!(is_int($array["user"]) || is_string($array["user"]) || get_class($array["user"]) == "Ramsey\Uuid\Uuid")) {
                $array["user"] = $array["user"]->getId();
            }
            if (is_array($array["stream"]) && isset($array["stream"]["object"])) {
                $array["stream"] = $array["stream"]["object"];
            }
            if (!(is_int($array["stream"]) || is_string($array["stream"]) || get_class($array["stream"]) == "Ramsey\Uuid\Uuid")) {
                $array["stream"] = $array["stream"]->getId();
            }
            $array["user_stream_id"] = $array["user"] . "_" . $array["stream"];
            unset($array["user"]);
            unset($array["stream"]);
        }
        return parent::findOneBy($array);
    }

}
